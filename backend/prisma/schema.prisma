generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model DeviceModel {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  isEnabled Boolean  @default(true) // Soft delete flag
  issues    Issue[]
}

model Issue {
  id        Int         @id @default(autoincrement())
  
  submitDate    DateTime @default(now())
  reporterName  String
  contact       String?
  modelId       Int
  model         DeviceModel @relation(fields: [modelId], references: [id])
  serialNumber  String?
  purchaseDate  DateTime?
  customerName  String?
  firmware      String?
  softwareVer   String?

  title         String
  occurredAt    DateTime?
  frequency     String?
  phenomenon    String?
  errorCode     String?
  description   String

  environment   String?
  location      String?
  waterType     String?
  voltage       String?
  usageFrequency String?

  restarted     Boolean?
  cleaned       Boolean?
  replacedPart  String?
  troubleshooting String?

  status        String   @default("PENDING")
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  attachments   Attachment[]
  comments      Comment[]

  customData    String? // JSON string to store dynamic form data
}

model FormField {
  id          Int      @id @default(autoincrement())
  label       String
  type        String   // text, textarea, select, checkbox, radio
  options     String?  // JSON string for options ["A", "B"]
  required    Boolean  @default(false)
  order       Int      @default(0)
  isEnabled   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Attachment {
  id        Int      @id @default(autoincrement())
  filename  String
  path      String
  mimeType  String
  size      Int
  sha256    String?
  kind      String

  issueId   Int?
  issue     Issue?   @relation(fields: [issueId], references: [id])
  
  createdAt DateTime @default(now())

  @@index([sha256])
}

model Comment {
  id         Int      @id @default(autoincrement())
  type       String   @default("MESSAGE")
  content    String?
  isInternal Boolean  @default(false)

  oldStatus  String?
  newStatus  String?
  
  author     String   

  createdAt  DateTime @default(now())

  issueId    Int
  issue      Issue    @relation(fields: [issueId], references: [id])
}
